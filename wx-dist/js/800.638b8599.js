"use strict";(self["webpackChunkhealth_app"]=self["webpackChunkhealth_app"]||[]).push([[800],{6800:function(e,a,l){l.r(a),l.d(a,{default:function(){return C}});l(4114);var t=l(6768),o=l(4232),s=l(144),n=l(715),u=l(1387),i=l(4373);const r={class:"profile-page"},c={class:"user-header"},d={class:"user-info"},v={class:"user-name"},h={class:"info-section"},p={class:"info-section"},g={class:"logout-section"},m={class:"avatar-list"},k=["onClick"];var b={__name:"Profile",setup(e){const a=(0,u.rd)(),l=(0,s.KR)({}),b=(0,s.KR)(0),f=(0,s.KR)(0),w=(0,s.KR)(!1),C=(0,s.KR)({nickname:"",height:"",weight:""}),F=["https://api.dicebear.com/7.x/avataaars/svg?seed=Felix&backgroundColor=b6e3f4","https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka&backgroundColor=d1d4f9","https://api.dicebear.com/7.x/avataaars/svg?seed=Luna&backgroundColor=c0aede","https://api.dicebear.com/7.x/avataaars/svg?seed=Max&backgroundColor=ffdfbf","https://api.dicebear.com/7.x/avataaars/svg?seed=Zoe&backgroundColor=ffd5dc"],y=(0,s.KR)(!1),P=(0,s.KR)(""),_=i.A.create({baseURL:"https://lgj-8082.colorstoneai.com",timeout:1e4,headers:{"Content-Type":"application/json"}});_.interceptors.request.use((e=>{const a=localStorage.getItem("token");return a&&(e.headers.Authorization=`Bearer ${a}`),e}));const L=async()=>{try{const e=await _.get("/api/v1/reports/healpth/count");0===e.data.code?(b.value=e.data.data.reportFileCount||0,f.value=e.data.data.healthReportCount||0):console.error("获取统计信息失败:",e.data.message)}catch(e){console.error("获取统计信息失败:",e)}},V=async()=>{try{(0,n.D0)({message:"加载中...",forbidClick:!0});const e=await _.get("/api/profile/info");0===e.data.code?(l.value=e.data.data,C.value={nickname:l.value.nickname||"",height:l.value.height||"",weight:l.value.weight||""}):(0,n.P0)(e.data.message||"获取用户信息失败")}catch(e){403===e.response?.status?((0,n.P0)("登录已过期，请重新登录"),localStorage.removeItem("token"),a.push("/login")):((0,n.P0)("获取用户信息失败"),console.error("获取用户信息失败:",e))}finally{(0,n.cQ)()}},I=e=>e?`${e.slice(0,3)}****${e.slice(7)}`:"",K=()=>{w.value=!0},R=async()=>{try{(0,n.D0)({message:"保存中...",forbidClick:!0});const e=await _.put("/api/profile/updateInfo",{nickname:C.value.nickname,height:Number(C.value.height)||null,weight:Number(C.value.weight)||null});0===e.data.code?((0,n.P0)("保存成功"),V(),w.value=!1):(0,n.P0)(e.data.message||"保存失败")}catch(e){console.error("保存失败:",e),403===e.response?.status||401===e.response?.status?((0,n.P0)("登录已过期，请重新登录"),localStorage.removeItem("token"),a.push("/login")):400===e.response?.status?(0,n.P0)(e.response.data.message||"输入数据有误"):((0,n.P0)("保存失败，请重试"),w.value=!1)}finally{(0,n.cQ)()}},x=()=>{localStorage.removeItem("token"),a.push("/login"),(0,n.P0)("已退出登录")},$=async()=>{if(P.value)try{(0,n.D0)({message:"保存中...",forbidClick:!0});const e=await _.put("/api/profile/updateInfo",{avatar:P.value});0===e.data.code?((0,n.P0)("头像更新成功"),V()):(0,n.P0)(e.data.message||"更新失败")}catch(e){console.error("更新头像失败:",e),403===e.response?.status||401===e.response?.status?((0,n.P0)("登录已过期，请重新登录"),localStorage.removeItem("token"),a.push("/login")):(0,n.P0)("更新失败，请重试")}finally{(0,n.cQ)()}else(0,n.P0)("请选择头像")};return(0,t.sV)((()=>{V(),L()})),(e,a)=>{const s=(0,t.g2)("van-image"),n=(0,t.g2)("van-button"),u=(0,t.g2)("van-cell"),i=(0,t.g2)("van-cell-group"),_=(0,t.g2)("van-field"),L=(0,t.g2)("van-form"),V=(0,t.g2)("van-dialog");return(0,t.uX)(),(0,t.CE)(t.FK,null,[(0,t.Lk)("div",r,[(0,t.Lk)("div",c,[(0,t.Lk)("div",d,[(0,t.bF)(s,{round:"",width:"64",height:"64",src:l.value.avatar||F[0],class:"avatar",onClick:a[0]||(a[0]=e=>y.value=!0)},null,8,["src"]),(0,t.Lk)("div",v,(0,o.v_)(l.value.nickname||l.value.username||"未设置昵称"),1)]),(0,t.bF)(n,{type:"primary",size:"small",icon:"edit",class:"edit-btn",onClick:K},{default:(0,t.k6)((()=>a[6]||(a[6]=[(0,t.eW)(" 编辑资料 ")]))),_:1})]),(0,t.Lk)("div",h,[a[7]||(a[7]=(0,t.Lk)("div",{class:"section-title"},"基本信息",-1)),(0,t.bF)(i,{inset:""},{default:(0,t.k6)((()=>[(0,t.bF)(u,{title:"姓名",value:l.value.username||"未设置"},null,8,["value"]),(0,t.bF)(u,{title:"手机号",value:I(l.value.phone)||"未绑定"},null,8,["value"]),(0,t.bF)(u,{title:"身高",value:l.value.height?`${l.value.height}cm`:"未设置"},null,8,["value"]),(0,t.bF)(u,{title:"体重",value:l.value.weight?`${l.value.weight}kg`:"未设置"},null,8,["value"])])),_:1})]),(0,t.Lk)("div",p,[a[8]||(a[8]=(0,t.Lk)("div",{class:"section-title"},"健康信息",-1)),(0,t.bF)(i,{inset:""},{default:(0,t.k6)((()=>[(0,t.bF)(u,{title:"体检报告",value:`${b.value}份`,"is-link":"",to:"/report"},null,8,["value"]),(0,t.bF)(u,{title:"健康方案",value:`${f.value}份`,"is-link":"",to:"/plan"},null,8,["value"])])),_:1})]),(0,t.Lk)("div",g,[(0,t.bF)(n,{type:"danger",block:"",onClick:x,class:"logout-btn"},{default:(0,t.k6)((()=>a[9]||(a[9]=[(0,t.eW)(" 退出登录 ")]))),_:1})])]),(0,t.bF)(V,{show:w.value,"onUpdate:show":a[4]||(a[4]=e=>w.value=e),title:"编辑资料","show-cancel-button":"",onConfirm:R},{default:(0,t.k6)((()=>[(0,t.bF)(L,null,{default:(0,t.k6)((()=>[(0,t.bF)(i,{inset:""},{default:(0,t.k6)((()=>[(0,t.bF)(_,{modelValue:C.value.nickname,"onUpdate:modelValue":a[1]||(a[1]=e=>C.value.nickname=e),label:"昵称",placeholder:"请输入昵称"},null,8,["modelValue"]),(0,t.bF)(_,{modelValue:C.value.height,"onUpdate:modelValue":a[2]||(a[2]=e=>C.value.height=e),label:"身高",placeholder:"请输入身高(cm)",type:"number"},null,8,["modelValue"]),(0,t.bF)(_,{modelValue:C.value.weight,"onUpdate:modelValue":a[3]||(a[3]=e=>C.value.weight=e),label:"体重",placeholder:"请输入体重(kg)",type:"number"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1},8,["show"]),(0,t.bF)(V,{show:y.value,"onUpdate:show":a[5]||(a[5]=e=>y.value=e),title:"选择头像","show-cancel-button":"",onConfirm:$},{default:(0,t.k6)((()=>[(0,t.Lk)("div",m,[((0,t.uX)(),(0,t.CE)(t.FK,null,(0,t.pI)(F,((e,a)=>(0,t.Lk)("div",{key:a,class:(0,o.C4)(["avatar-item",{active:P.value===e}]),onClick:a=>P.value=e},[(0,t.bF)(s,{round:"",width:"60",height:"60",src:e},null,8,["src"])],10,k))),64))])])),_:1},8,["show"])],64)}}},f=l(1241);const w=(0,f.A)(b,[["__scopeId","data-v-217bd0eb"]]);var C=w}}]);
//# sourceMappingURL=800.638b8599.js.map