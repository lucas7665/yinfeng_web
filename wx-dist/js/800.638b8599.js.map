{"version":3,"file":"js/800.638b8599.js","mappings":"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","sources":["webpack://health-app/./src/views/Profile.vue","webpack://health-app/./src/views/Profile.vue?24e8"],"sourcesContent":["<template>\n  <div class=\"profile-page\">\n    <!-- 用户信息头部 -->\n    <div class=\"user-header\">\n      <div class=\"user-info\">\n        <van-image\n          round\n          width=\"64\"\n          height=\"64\"\n          :src=\"userInfo.avatar || defaultAvatars[0]\"\n          class=\"avatar\"\n          @click=\"showAvatarDialog = true\"\n        />\n        <div class=\"user-name\">{{ userInfo.nickname || userInfo.username || '未设置昵称' }}</div>\n      </div>\n      <van-button \n        type=\"primary\" \n        size=\"small\" \n        icon=\"edit\"\n        class=\"edit-btn\"\n        @click=\"handleEdit\"\n      >\n        编辑资料\n      </van-button>\n    </div>\n\n    <!-- 基本信息 -->\n    <div class=\"info-section\">\n      <div class=\"section-title\">基本信息</div>\n      <van-cell-group inset>\n        <van-cell title=\"姓名\" :value=\"userInfo.username || '未设置'\" />\n        <van-cell title=\"手机号\" :value=\"formatPhone(userInfo.phone) || '未绑定'\" />\n        <van-cell title=\"身高\" :value=\"userInfo.height ? `${userInfo.height}cm` : '未设置'\" />\n        <van-cell title=\"体重\" :value=\"userInfo.weight ? `${userInfo.weight}kg` : '未设置'\" />\n      </van-cell-group>\n    </div>\n\n    <!-- 健康信息 -->\n    <div class=\"info-section\">\n      <div class=\"section-title\">健康信息</div>\n      <van-cell-group inset>\n        <van-cell title=\"体检报告\" :value=\"`${reportCount}份`\" is-link to=\"/report\" />\n        <van-cell title=\"健康方案\" :value=\"`${planCount}份`\" is-link to=\"/plan\" />\n      </van-cell-group>\n    </div>\n\n    <!-- 退出登录 -->\n    <div class=\"logout-section\">\n      <van-button \n        type=\"danger\" \n        block \n        @click=\"handleLogout\"\n        class=\"logout-btn\"\n      >\n        退出登录\n      </van-button>\n    </div>\n  </div>\n\n  <!-- 编辑资料弹窗 -->\n  <van-dialog\n    v-model:show=\"showEditDialog\"\n    title=\"编辑资料\"\n    show-cancel-button\n    @confirm=\"handleEditConfirm\"\n  >\n    <van-form>\n      <van-cell-group inset>\n        <van-field\n          v-model=\"editForm.nickname\"\n          label=\"昵称\"\n          placeholder=\"请输入昵称\"\n        />\n        <van-field\n          v-model=\"editForm.height\"\n          label=\"身高\"\n          placeholder=\"请输入身高(cm)\"\n          type=\"number\"\n        />\n        <van-field\n          v-model=\"editForm.weight\"\n          label=\"体重\"\n          placeholder=\"请输入体重(kg)\"\n          type=\"number\"\n        />\n      </van-cell-group>\n    </van-form>\n  </van-dialog>\n\n  <!-- 头像选择弹窗 -->\n  <van-dialog\n    v-model:show=\"showAvatarDialog\"\n    title=\"选择头像\"\n    show-cancel-button\n    @confirm=\"handleAvatarConfirm\"\n  >\n    <div class=\"avatar-list\">\n      <div \n        v-for=\"(avatar, index) in defaultAvatars\" \n        :key=\"index\"\n        class=\"avatar-item\"\n        :class=\"{ active: selectedAvatar === avatar }\"\n        @click=\"selectedAvatar = avatar\"\n      >\n        <van-image\n          round\n          width=\"60\"\n          height=\"60\"\n          :src=\"avatar\"\n        />\n      </div>\n    </div>\n  </van-dialog>\n</template>\n\n<script setup>\nimport { ref, onMounted } from 'vue'\nimport { showToast, showLoadingToast, closeToast } from 'vant'\nimport { useRouter } from 'vue-router'\nimport axios from 'axios'\n\nconst router = useRouter()\nconst userInfo = ref({})\nconst reportCount = ref(0)\nconst planCount = ref(0)\nconst showEditDialog = ref(false)\nconst editForm = ref({\n  nickname: '',\n  height: '',\n  weight: ''\n})\n\n// 修改默认头像列表为在线生成的头像\nconst defaultAvatars = [\n  'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix&backgroundColor=b6e3f4',\n  'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka&backgroundColor=d1d4f9',\n  'https://api.dicebear.com/7.x/avataaars/svg?seed=Luna&backgroundColor=c0aede',\n  'https://api.dicebear.com/7.x/avataaars/svg?seed=Max&backgroundColor=ffdfbf',\n  'https://api.dicebear.com/7.x/avataaars/svg?seed=Zoe&backgroundColor=ffd5dc'\n]\n\n// 头像选择相关\nconst showAvatarDialog = ref(false)\nconst selectedAvatar = ref('')\n\n// 创建 axios 实例\nconst http = axios.create({\n  baseURL: 'https://lgj-8082.colorstoneai.com',\n  timeout: 10000,\n  headers: {\n    'Content-Type': 'application/json'\n  }\n})\n\n// 请求拦截器：添加 token\nhttp.interceptors.request.use(config => {\n  const token = localStorage.getItem('token')\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`\n  }\n  return config\n})\n\n// 获取统计信息\nconst getStatistics = async () => {\n  try {\n    const res = await http.get('/api/v1/reports/healpth/count')\n    if (res.data.code === 0) {  // 修改这里，判断 code === 0\n      reportCount.value = res.data.data.reportFileCount || 0\n      planCount.value = res.data.data.healthReportCount || 0\n    } else {\n      console.error('获取统计信息失败:', res.data.message)\n    }\n  } catch (error) {\n    console.error('获取统计信息失败:', error)\n  }\n}\n\n// 获取用户信息\nconst getUserInfo = async () => {\n  try {\n    showLoadingToast({\n      message: '加载中...',\n      forbidClick: true,\n    })\n\n    const res = await http.get('/api/profile/info')\n    if (res.data.code === 0) {\n      userInfo.value = res.data.data\n      // 初始化编辑表单\n      editForm.value = {\n        nickname: userInfo.value.nickname || '',\n        height: userInfo.value.height || '',\n        weight: userInfo.value.weight || ''\n      }\n    } else {\n      showToast(res.data.message || '获取用户信息失败')\n    }\n  } catch (error) {\n    if (error.response?.status === 403) {\n      showToast('登录已过期，请重新登录')\n      localStorage.removeItem('token')\n      router.push('/login')\n    } else {\n      showToast('获取用户信息失败')\n      console.error('获取用户信息失败:', error)\n    }\n  } finally {\n    closeToast()\n  }\n}\n\n// 格式化手机号\nconst formatPhone = (phone) => {\n  if (!phone) return ''\n  return `${phone.slice(0, 3)}****${phone.slice(7)}`\n}\n\n// 编辑资料\nconst handleEdit = () => {\n  showEditDialog.value = true\n}\n\n// 确认编辑\nconst handleEditConfirm = async () => {\n  try {\n    showLoadingToast({\n      message: '保存中...',\n      forbidClick: true,\n    })\n\n    // 修改为 PUT 请求\n    const res = await http.put('/api/profile/updateInfo', {\n      // 按照 UpdateProfileRequest 的格式构造请求体\n      nickname: editForm.value.nickname,\n      height: Number(editForm.value.height) || null,  // 转换为数字\n      weight: Number(editForm.value.weight) || null   // 转换为数字\n    })\n    \n    if (res.data.code === 0) {\n      showToast('保存成功')\n      getUserInfo()  // 刷新用户信息\n      showEditDialog.value = false  // 关闭弹窗\n    } else {\n      showToast(res.data.message || '保存失败')\n    }\n  } catch (error) {\n    console.error('保存失败:', error)\n    if (error.response?.status === 403 || error.response?.status === 401) {\n      showToast('登录已过期，请重新登录')\n      localStorage.removeItem('token')\n      router.push('/login')\n    } else if (error.response?.status === 400) {\n      showToast(error.response.data.message || '输入数据有误')\n      // 400 错误不关闭弹窗，让用户修改输入\n    } else {\n      showToast('保存失败，请重试')\n      showEditDialog.value = false  // 其他错误关闭弹窗\n    }\n  } finally {\n    closeToast()\n  }\n}\n\n// 退出登录\nconst handleLogout = () => {\n  localStorage.removeItem('token')\n  router.push('/login')\n  showToast('已退出登录')\n}\n\n// 确认头像选择\nconst handleAvatarConfirm = async () => {\n  if (!selectedAvatar.value) {\n    showToast('请选择头像')\n    return\n  }\n\n  try {\n    showLoadingToast({\n      message: '保存中...',\n      forbidClick: true,\n    })\n\n    const res = await http.put('/api/profile/updateInfo', {\n      avatar: selectedAvatar.value\n    })\n    \n    if (res.data.code === 0) {\n      showToast('头像更新成功')\n      getUserInfo()  // 刷新用户信息\n    } else {\n      showToast(res.data.message || '更新失败')\n    }\n  } catch (error) {\n    console.error('更新头像失败:', error)\n    if (error.response?.status === 403 || error.response?.status === 401) {\n      showToast('登录已过期，请重新登录')\n      localStorage.removeItem('token')\n      router.push('/login')\n    } else {\n      showToast('更新失败，请重试')\n    }\n  } finally {\n    closeToast()\n  }\n}\n\nonMounted(() => {\n  getUserInfo()\n  getStatistics()  // 单独调用获取统计信息\n})\n</script>\n\n<style scoped>\n.profile-page {\n  min-height: calc(100vh - 50px);\n  background-color: #f0f5ff;  /* 改为浅蓝色 */\n  padding: 12px;\n}\n\n.user-header {\n  background-color: #ffffff;\n  border-radius: 8px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  padding: 24px 16px;\n  margin-bottom: 12px;\n  display: flex;\n  justify-content: space-between;  /* 让编辑按钮靠右 */\n  align-items: center;\n}\n\n.user-info {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n  flex: 1;  /* 添加这行，让用户信息占据剩余空间 */\n}\n\n.user-name {\n  font-size: 18px;\n  font-weight: 500;\n}\n\n.info-section {\n  background-color: #ffffff;\n  border-radius: 8px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  padding: 16px;\n  margin-bottom: 12px;\n}\n\n.section-title {\n  font-size: 16px;\n  font-weight: 500;\n  color: #323233;\n  margin: 16px 0 12px;\n}\n\n.logout-section {\n  margin-top: 24px;\n  padding: 0 16px;\n}\n\n.logout-btn {\n  margin-top: 24px;\n}\n\n.edit-btn {\n  flex-shrink: 0;  /* 确保按钮不会被压缩 */\n  margin-left: auto;  /* 添加这行，强制按钮靠右 */\n}\n\n.avatar {\n  cursor: pointer;\n}\n\n.avatar-list {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  gap: 16px;\n  padding: 16px;\n}\n\n.avatar-item {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n  padding: 8px;\n  border-radius: 8px;\n  transition: background-color 0.3s;\n}\n\n.avatar-item:hover {\n  background-color: #f5f5f5;\n}\n\n.avatar-item.active {\n  background-color: #e8f3ff;\n  border: 2px solid #1989fa;\n}\n</style> ","import script from \"./Profile.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Profile.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Profile.vue?vue&type=style&index=0&id=217bd0eb&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-217bd0eb\"]])\n\nexport default __exports__"],"names":["router","useRouter","userInfo","ref","reportCount","planCount","showEditDialog","editForm","nickname","height","weight","defaultAvatars","showAvatarDialog","selectedAvatar","http","axios","create","baseURL","timeout","headers","interceptors","request","use","config","token","localStorage","getItem","Authorization","getStatistics","async","res","get","data","code","value","reportFileCount","healthReportCount","console","error","message","getUserInfo","showLoadingToast","forbidClick","showToast","response","status","removeItem","push","closeToast","formatPhone","phone","slice","handleEdit","handleEditConfirm","put","Number","handleLogout","handleAvatarConfirm","avatar","onMounted","__exports__"],"sourceRoot":""}