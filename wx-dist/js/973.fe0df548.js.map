{"version":3,"file":"js/973.fe0df548.js","mappings":"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","sources":["webpack://health-app/./src/views/Report.vue","webpack://health-app/./src/views/Report.vue?305c"],"sourcesContent":["<template>\n  <div class=\"report-page\">\n    <van-tabs v-model:active=\"activeTab\" sticky>\n      <van-tab title=\"我的报告\" name=\"my\">\n        <div class=\"content\">\n          <van-button type=\"primary\" block @click=\"handleUpload\" class=\"upload-btn\">\n            上传报告\n          </van-button>\n\n          <!-- 报告列表 -->\n          <div class=\"report-list\">\n            <van-cell v-for=\"report in reports\" :key=\"report.id\">\n              <template #icon>\n                <van-radio \n                  :name=\"report.id\" \n                  v-model=\"selectedReportId\"\n                  class=\"report-radio\"\n                />\n              </template>\n              <template #title>\n                <div class=\"report-title\">{{ report.fileName }}</div>\n                <div class=\"report-time\">{{ formatDate(report.uploadTime) }}</div>\n              </template>\n              <template #right-icon>\n                <div class=\"cell-right\">\n                  <van-tag :type=\"report.pdfGenerated === 1 ? 'success' : 'warning'\" class=\"status-tag\">\n                    {{ report.pdfGenerated === 1 ? '已生成' : '已上传' }}\n                  </van-tag>\n                  <van-button \n                    type=\"primary\" \n                    size=\"small\" \n                    @click.stop=\"viewFile(report)\"\n                    class=\"view-btn\"\n                  >\n                    查看\n                  </van-button>\n                  <van-button \n                    type=\"danger\" \n                    size=\"small\" \n                    @click.stop=\"handleDelete(report)\"\n                    class=\"delete-btn\"\n                  >\n                    删除\n                  </van-button>\n                </div>\n              </template>\n            </van-cell>\n          </div>\n\n          <!-- 分页器 -->\n          <div class=\"pagination-wrapper\">\n            <van-empty v-if=\"!loading && !reports.length\" description=\"暂无报告\" />\n            <van-pagination\n              v-else\n              v-model=\"currentPage\"\n              :total-items=\"total\"\n              :items-per-page=\"pageSize\"\n              :show-page-size=\"3\"\n              force-ellipses\n              @change=\"onPageChange\"\n            />\n          </div>\n\n          <van-button \n            type=\"info\" \n            block \n            @click=\"generatePDF\" \n            class=\"generate-btn\"\n            :disabled=\"!selectedReportId\"\n          >\n            生成PDF报告\n          </van-button>\n        </div>\n      </van-tab>\n      <van-tab title=\"他人报告\" name=\"others\">\n        <div class=\"content\">\n          <van-button type=\"primary\" block @click=\"handleUpload\" class=\"upload-btn\">\n            上传报告\n          </van-button>\n\n          <!-- 报告列表 -->\n          <div class=\"report-list\">\n            <van-cell v-for=\"report in otherReports\" :key=\"report.id\">\n              <template #icon>\n                <van-radio \n                  :name=\"report.id\" \n                  v-model=\"otherSelectedReportId\"\n                  class=\"report-radio\"\n                />\n              </template>\n              <template #title>\n                <div class=\"report-title\">{{ report.fileName }}</div>\n                <div class=\"report-time\">{{ formatDate(report.uploadTime) }}</div>\n              </template>\n              <template #right-icon>\n                <div class=\"cell-right\">\n                  <van-tag :type=\"report.pdfGenerated === 1 ? 'success' : 'warning'\" class=\"status-tag\">\n                    {{ report.pdfGenerated === 1 ? '已生成' : '已上传' }}\n                  </van-tag>\n                  <van-button \n                    type=\"primary\" \n                    size=\"small\" \n                    @click.stop=\"viewFile(report)\"\n                    class=\"view-btn\"\n                  >\n                    查看\n                  </van-button>\n                  <van-button \n                    type=\"danger\" \n                    size=\"small\" \n                    @click.stop=\"handleDelete(report)\"\n                    class=\"delete-btn\"\n                  >\n                    删除\n                  </van-button>\n                </div>\n              </template>\n            </van-cell>\n          </div>\n\n          <!-- 分页器 -->\n          <div class=\"pagination-wrapper\">\n            <van-empty v-if=\"!otherLoading && !otherReports.length\" description=\"暂无报告\" />\n            <van-pagination\n              v-else\n              v-model=\"otherPage\"\n              :total-items=\"otherTotal\"\n              :items-per-page=\"otherPageSize\"\n              :show-page-size=\"3\"\n              force-ellipses\n              @change=\"onOtherPageChange\"\n            />\n          </div>\n\n          <van-button \n            type=\"info\" \n            block \n            @click=\"generateOtherPDF\" \n            class=\"generate-btn\"\n            :disabled=\"!otherSelectedReportId\"\n          >\n            生成PDF报告\n          </van-button>\n        </div>\n      </van-tab>\n    </van-tabs>\n\n    <input \n      type=\"file\" \n      ref=\"fileInput\"\n      style=\"display: none\"\n      @change=\"uploadFile\"\n      accept=\".pdf,.doc,.docx\"\n    >\n\n    <!-- 文件预览弹窗 -->\n    <van-dialog\n      v-model:show=\"showPreview\"\n      :title=\"currentFile?.fileName\"\n      class=\"preview-dialog\"\n      closeable\n      close-icon=\"close\"\n    >\n      <div class=\"preview-container\">\n        <div class=\"resize-handle\" @mousedown=\"startResize\"></div>\n        <iframe \n          v-if=\"currentFile?.fileType === 'application/pdf'\"\n          :src=\"currentFile?.fileUrl\" \n          frameborder=\"0\"\n          class=\"pdf-preview\"\n        ></iframe>\n        <img \n          v-else-if=\"currentFile?.fileType.startsWith('image/')\"\n          :src=\"currentFile?.fileUrl\" \n          class=\"image-preview\"\n        />\n        <div v-else class=\"unsupported-preview\">\n          <van-button type=\"primary\" @click=\"downloadFile(currentFile)\">下载文件</van-button>\n          <p>该文件类型不支持在线预览</p>\n        </div>\n      </div>\n    </van-dialog>\n\n    <!-- 删除确认弹窗 -->\n    <van-dialog\n      v-model:show=\"showDeleteDialog\"\n      title=\"删除确认\"\n      show-cancel-button\n      @confirm=\"confirmDelete\"\n    >\n      <div class=\"delete-confirm-content\">\n        确定要删除这份报告吗？此操作不可恢复。\n      </div>\n    </van-dialog>\n  </div>\n</template>\n\n<script setup>\nimport { ref, onMounted, watch } from 'vue'\nimport { showToast, showLoadingToast, closeToast } from 'vant'\nimport { useRouter } from 'vue-router'\nimport axios from 'axios'\n\nconst router = useRouter()\nconst activeTab = ref('my')\nconst reports = ref([])\nconst loading = ref(false)\nconst currentPage = ref(1)\nconst pageSize = 10\nconst total = ref(0)\nconst fileInput = ref(null)\n\n// 文件预览相关\nconst showPreview = ref(false)\nconst currentFile = ref(null)\n\n// 单选框相关\nconst selectedReportId = ref(null)\n\n// 删除相关\nconst showDeleteDialog = ref(false)\nconst reportToDelete = ref(null)\n\n// 他人报告相关变量\nconst otherReports = ref([])\nconst otherLoading = ref(false)\nconst otherPage = ref(1)\nconst otherPageSize = 10\nconst otherTotal = ref(0)\nconst otherSelectedReportId = ref(null)\n\n// 创建 axios 实例\nconst http = axios.create({\n  baseURL: 'https://lgj-8082.colorstoneai.com',\n  timeout: 60000,  // 增加到 60 秒\n  headers: {\n    'Content-Type': 'application/json'\n  }\n})\n\n// 请求拦截器：添加 token\nhttp.interceptors.request.use(config => {\n  const token = localStorage.getItem('token')\n  if (token) {\n    config.headers.Authorization = `Bearer ${token}`\n  }\n  return config\n})\n\nconst getReportList = async () => {\n  if (loading.value) return\n  \n  try {\n    loading.value = true\n    showLoadingToast({\n      message: '加载中...',\n      forbidClick: true,\n    })\n\n    const res = await http.get(`/api/v1/reports`, {\n      params: {\n        page: currentPage.value,\n        size: pageSize,\n        planType: 1  // 添加 planType=1 表示我的报告\n      }\n    })\n    \n    if (res.data.code === 0) {\n      reports.value = res.data.data || []\n      total.value = res.data.total || 0\n    } else {\n      showToast(res.data.message || '获取列表失败')\n    }\n  } catch (error) {\n    console.error('获取报告列表失败:', error)\n    if (error.response?.status === 403) {\n      showToast('登录已过期，请重新登录')\n      localStorage.removeItem('token')\n      router.push('/login')\n    } else {\n      showToast('获取列表失败')\n    }\n  } finally {\n    loading.value = false\n    closeToast()\n  }\n}\n\nconst onPageChange = (page) => {\n  currentPage.value = page\n  selectedReportId.value = null  // 清除选择\n  getReportList()\n}\n\nconst handleUpload = () => {\n  fileInput.value.click()\n}\n\nconst uploadFile = async (e) => {\n  const file = e.target.files[0]\n  if (!file) return\n\n  const formData = new FormData()\n  formData.append('file', file)\n\n  try {\n    showLoadingToast({\n      message: '上传中...',\n      forbidClick: true,\n    })\n\n    const res = await http.post('/api/v1/reports/upload', formData, {\n      headers: {\n        'Content-Type': 'multipart/form-data'\n      }\n    })\n    if (res.data.code === 0) {\n      showToast('上传成功')\n      currentPage.value = 1 // 重置到第一页\n      getReportList()\n    } else {\n      showToast(res.data.message || '上传失败')\n    }\n  } catch (error) {\n    if (error.response?.status === 403) {\n      showToast('登录已过期，请重新登录')\n      localStorage.removeItem('token')\n      router.push('/login')\n    } else {\n      showToast('上传失败')\n      console.error('上传失败:', error)\n    }\n  } finally {\n    closeToast()\n  }\n}\n\nconst generatePDF = async () => {\n  if (!selectedReportId.value) {\n    showToast('请先选择一份报告')\n    return\n  }\n\n  const selectedReport = reports.value.find(report => report.id === selectedReportId.value)\n  if (!selectedReport) {\n    showToast('所选报告不存在')\n    return\n  }\n\n  try {\n    showLoadingToast({\n      message: '生成中...',\n      forbidClick: true,\n      duration: 0  // 设置为 0 表示不自动关闭\n    })\n\n    // 使用 URLSearchParams 构建表单数据\n    const params = new URLSearchParams()\n    params.append('reportId', selectedReport.id)\n    params.append('reportUrl', selectedReport.fileUrl)\n    params.append('planType', '1')\n\n    const res = await http.post('/api/health-plan/generatepdf', params, {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      timeout: 120000  // 为生成 PDF 单独设置 120 秒超时\n    })\n    \n    if (res.data.code === 0) {\n      showToast('PDF生成成功')\n    } else {\n      showToast(res.data.message || 'PDF生成失败')\n    }\n  } catch (error) {\n    if (error.response?.status === 403) {\n      showToast('登录已过期，请重新登录')\n      localStorage.removeItem('token')\n      router.push('/login')\n    } else {\n      showToast('PDF生成失败')\n      console.error('生成PDF失败:', error)\n    }\n  } finally {\n    closeToast()\n  }\n}\n\nconst formatDate = (date) => {\n  return new Date(date).toLocaleDateString()\n}\n\nconst viewFile = (report) => {\n  currentFile.value = report\n  showPreview.value = true\n}\n\nconst downloadFile = (file) => {\n  if (!file?.fileUrl) return\n  window.open(file.fileUrl, '_blank')\n}\n\n// 拖拽调整大小相关\nconst startResize = (e) => {\n  e.preventDefault()\n  const dialog = document.querySelector('.preview-dialog')\n  const initialHeight = dialog.offsetHeight\n  const initialY = e.clientY\n\n  const handleMouseMove = (moveEvent) => {\n    const deltaY = moveEvent.clientY - initialY\n    const newHeight = Math.min(Math.max(initialHeight + deltaY, 400), window.innerHeight * 0.95)\n    dialog.style.height = `${newHeight}px`\n  }\n\n  const handleMouseUp = () => {\n    document.removeEventListener('mousemove', handleMouseMove)\n    document.removeEventListener('mouseup', handleMouseUp)\n  }\n\n  document.addEventListener('mousemove', handleMouseMove)\n  document.addEventListener('mouseup', handleMouseUp)\n}\n\n// 处理删除按钮点击\nconst handleDelete = (report) => {\n  reportToDelete.value = report\n  showDeleteDialog.value = true\n}\n\n// 确认删除\nconst confirmDelete = async () => {\n  if (!reportToDelete.value) return\n\n  try {\n    showLoadingToast({\n      message: '删除中...',\n      forbidClick: true,\n    })\n\n    const res = await http.delete(`/api/v1/reports/${reportToDelete.value.id}`)\n    \n    if (res.data.code === 0) {\n      showToast('删除成功')\n      // 如果当前页只有一条数据且不是第一页，则跳转到上一页\n      if (reports.value.length === 1 && currentPage.value > 1) {\n        currentPage.value--\n      }\n      getReportList()  // 刷新列表\n    } else {\n      showToast(res.data.message || '删除失败')\n    }\n  } catch (error) {\n    console.error('删除失败:', error)\n    if (error.response?.status === 403 || error.response?.status === 401) {\n      showToast('登录已过期，请重新登录')\n      localStorage.removeItem('token')\n      router.push('/login')\n    } else {\n      showToast('删除失败，请重试')\n    }\n  } finally {\n    closeToast()\n    reportToDelete.value = null\n  }\n}\n\n// 获取他人报告列表\nconst getOtherReports = async () => {\n  if (otherLoading.value) return\n  \n  try {\n    otherLoading.value = true\n    showLoadingToast({\n      message: '加载中...',\n      forbidClick: true,\n    })\n\n    const res = await http.get(`/api/v1/reports`, {\n      params: {\n        page: otherPage.value,\n        size: otherPageSize,\n        planType: 2\n      }\n    })\n    \n    if (res.data.code === 0) {\n      otherReports.value = res.data.data || []\n      otherTotal.value = res.data.total || 0\n    } else {\n      showToast(res.data.message || '获取列表失败')\n    }\n  } catch (error) {\n    console.error('获取他人报告列表失败:', error)\n    showToast('获取列表失败')\n  } finally {\n    otherLoading.value = false\n    closeToast()\n  }\n}\n\n// 他人报告分页切换\nconst onOtherPageChange = (page) => {\n  otherPage.value = page\n  otherSelectedReportId.value = null  // 清除选择\n  getOtherReports()\n}\n\n// 生成他人报告PDF\nconst generateOtherPDF = async () => {\n  if (!otherSelectedReportId.value) {\n    showToast('请先选择一份报告')\n    return\n  }\n\n  const selectedReport = otherReports.value.find(report => report.id === otherSelectedReportId.value)\n  if (!selectedReport) {\n    showToast('所选报告不存在')\n    return\n  }\n\n  try {\n    showLoadingToast({\n      message: '生成中...',\n      forbidClick: true,\n      duration: 0\n    })\n\n    const params = new URLSearchParams()\n    params.append('reportId', selectedReport.id)\n    params.append('reportUrl', selectedReport.fileUrl)\n    params.append('planType', '2')  // 他人报告\n\n    const res = await http.post('/api/health-plan/generatepdf', params, {\n      headers: {\n        'Content-Type': 'application/x-www-form-urlencoded'\n      },\n      timeout: 120000\n    })\n    \n    if (res.data.code === 0) {\n      showToast('PDF生成成功')\n    } else {\n      showToast(res.data.message || 'PDF生成失败')\n    }\n  } catch (error) {\n    console.error('生成PDF失败:', error)\n    showToast('PDF生成失败')\n  } finally {\n    closeToast()\n  }\n}\n\n// 监听标签页切换\nwatch(activeTab, (newVal) => {\n  if (newVal === 'others') {\n    // 切换到他人报告标签页时，如果还没有数据就加载数据\n    if (otherReports.value.length === 0) {\n      getOtherReports()\n    }\n  }\n})\n\n// 修改初始化加载\nonMounted(() => {\n  // 根据当前标签页加载对应数据\n  if (activeTab.value === 'my') {\n    getReportList()\n  } else if (activeTab.value === 'others') {\n    getOtherReports()\n  }\n})\n</script>\n\n<style scoped>\n.report-page {\n  min-height: calc(100vh - 50px);\n  background-color: #f0f5ff;  /* 改为浅蓝色 */\n  padding-bottom: 50px;\n}\n\n.content {\n  padding: 12px;\n}\n\n.upload-btn,\n.generate-btn {\n  margin: 12px 0;\n}\n\n.report-list {\n  background-color: #ffffff;\n  border-radius: 8px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n  padding: 16px;\n  margin: 12px 0;\n}\n\n.pagination-wrapper {\n  display: flex;\n  justify-content: center;\n  margin: 16px 0;\n}\n\n.report-title {\n  font-size: 16px;\n  margin-bottom: 4px;\n}\n\n.report-time {\n  font-size: 12px;\n  color: #999;\n}\n\n.empty-tip {\n  text-align: center;\n  color: #999;\n  padding: 32px 0;\n}\n\n.cell-right {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n}\n\n.status-tag {\n  margin-right: 8px;\n}\n\n.view-btn,\n.delete-btn {\n  font-size: 12px;\n  padding: 0 12px;\n}\n\n.delete-btn {\n  margin-left: 8px;\n}\n\n.preview-dialog {\n  width: 95%;\n  height: 90vh;\n  max-width: 1200px;\n  resize: vertical; /* 允许垂直方向调整大小 */\n  overflow: hidden;\n}\n\n.preview-dialog :deep(.van-dialog__content) {\n  height: calc(100% - 56px);\n  padding: 0;\n  position: relative;\n}\n\n.resize-handle {\n  position: absolute;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  height: 6px;\n  background: transparent;\n  cursor: ns-resize;\n  z-index: 1;\n}\n\n.resize-handle:hover {\n  background: rgba(0, 0, 0, 0.1);\n}\n\n.preview-container {\n  height: 100%;\n  overflow: hidden;\n  background-color: #f5f5f5;\n  position: relative;\n}\n\n.pdf-preview,\n.image-preview {\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n  border: none;\n}\n\n.unsupported-preview {\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  gap: 16px;\n}\n\n.report-radio {\n  margin-right: 8px;\n  display: flex;\n  align-items: center;\n}\n\n.action-buttons {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n\n.delete-confirm-content {\n  padding: 16px;\n  text-align: center;\n  color: #666;\n}\n\n.search-bar {\n  padding: 16px;\n}\n\n.report-icon {\n  margin-left: 8px;\n}\n</style> ","import script from \"./Report.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Report.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Report.vue?vue&type=style&index=0&id=0b6619bc&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-0b6619bc\"]])\n\nexport default __exports__"],"names":["pageSize","otherPageSize","router","useRouter","activeTab","ref","reports","loading","currentPage","total","fileInput","showPreview","currentFile","selectedReportId","showDeleteDialog","reportToDelete","otherReports","otherLoading","otherPage","otherTotal","otherSelectedReportId","http","axios","create","baseURL","timeout","headers","interceptors","request","use","config","token","localStorage","getItem","Authorization","getReportList","async","value","showLoadingToast","message","forbidClick","res","get","params","page","size","planType","data","code","showToast","error","console","response","status","removeItem","push","closeToast","onPageChange","handleUpload","click","uploadFile","file","e","target","files","formData","FormData","append","post","generatePDF","selectedReport","find","report","id","duration","URLSearchParams","fileUrl","formatDate","date","Date","toLocaleDateString","viewFile","downloadFile","window","open","startResize","preventDefault","dialog","document","querySelector","initialHeight","offsetHeight","initialY","clientY","handleMouseMove","moveEvent","deltaY","newHeight","Math","min","max","innerHeight","style","height","handleMouseUp","removeEventListener","addEventListener","handleDelete","confirmDelete","delete","length","getOtherReports","onOtherPageChange","generateOtherPDF","watch","newVal","onMounted","__exports__"],"sourceRoot":""}